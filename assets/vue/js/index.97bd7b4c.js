(function(t){function e(e){for(var r,n,a=e[0],c=e[1],l=e[2],d=0,p=[];d<a.length;d++)n=a[d],o[n]&&p.push(o[n][0]),o[n]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);u&&u(e);while(p.length)p.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],r=!0,a=1;a<i.length;a++){var c=i[a];0!==o[c]&&(r=!1)}r&&(s.splice(e--,1),t=n(n.s=i[0]))}return t}var r={},o={index:0},s=[];function n(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=r,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="../../../plugins_packages/virtUOS/Courseware/views/block_manager/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var u=c;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("b635")},b635:function(t,e,i){"use strict";i.r(e);i("14c6"),i("08c1"),i("4842"),i("d9fc");var r=i("2b0e"),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"cw-blockmanager-content"}},[i("div",{staticClass:"cw-blockmanager-wrapper"},[i("div",{staticClass:"cw-blockmanager-title"},[i("p",[t._v(t._s(this.courseware.title))]),i("span",{staticClass:"cw-blockmanager-store-icon",attrs:{title:"speichern"}}),i("span",{staticClass:"cw-blockmanager-store-icon-error"},[t._v("Fehler beim Speichern")])]),i("ul",{staticClass:"chapter-list"},t._l(this.courseware.children,function(t){return i("ChapterItem",{key:t.id,attrs:{chapter:t,importContent:!1}})}),1)]),i("div",{staticClass:"cw-blockmanager-wrapper",attrs:{id:"cw-action-wrapper"}},[i("div",{staticClass:"cw-blockmanager-title",attrs:{id:"cw-import-title"}},[i("p",[t._v(t._s(t.actionTitle))])]),t.fileError?i("div",{staticClass:"messagebox messagebox_error"},[t._v("Das Archiv enthält keine Coursewaredaten")]):t._e(),i("div",{attrs:{id:"user-course-list"}},[i("ul",{staticClass:"semester-list"},t._l(this.remoteCourses,function(e,r){return i("SemesterItem",{key:r,attrs:{courses:e,semester_name:r},on:{"course-selected":t.getRemoteCourse}})}),1)]),t.remoteCourseware?i("div",{staticClass:"cw-remote-courseware"},[i("ul",{staticClass:"chapter-list chapter-list-import"},t._l(this.remoteCourseware.children,function(t){return i("ChapterItem",{key:t.id,attrs:{chapter:t,importContent:!0,remoteContent:!0}})}),1)]):t._e(),t.importCourseware?i("div",{attrs:{id:"cw-import-lists"}},[i("ul",{staticClass:"chapter-list chapter-list-import"},t._l(this.importCourseware.chapters,function(t){return i("ChapterItem",{key:t.id,attrs:{chapter:t,importContent:!0,remoteContent:!1}})}),1)]):t._e(),i("ul",{attrs:{id:"cw-action-selection"}},[i("li",[i("label",{staticClass:"cw-action-menu-button",attrs:{for:"cw-file-upload-import",id:"cw-file-upload-import-label",title:"Laden Sie eine Datei hoch, die Sie zuvor aus einer Courseware exportiert haben"}},[i("input",{staticClass:"cw-file-upload-import",attrs:{type:"file",name:"cw-file-upload-import",id:"cw-file-upload-import",accept:".zip"},on:{change:t.setImport}}),i("p",[t._v("Import-Archiv hochladen")])])]),i("li",[i("div",{staticClass:"cw-action-menu-button",attrs:{id:"cw-import-from-course",title:"Importieren Sie Inhalte aus einer anderen Veranstaltung in der Sie Dozent sind"},on:{click:t.importFromCourse}},[i("p",[t._v(t._s(t.courseImportText))])])]),i("li",[i("div",{staticClass:"cw-action-menu-button",attrs:{id:"cw-set-decontrol",title:""},on:{click:t.setDecontrol}},[i("p",[t._v(t._s(t.setDecontrolText))])])])]),i("button",{staticClass:"button",attrs:{id:"cw-reset-action-menu"},on:{click:t.resetActionMenu}},[t._v("zurück zur Auswahl")]),i("div",{staticStyle:{clear:"both"}})]),i("EditDialog"),i("RemoveDialog")],1)},s=[],n=(i("ac6a"),i("5df3"),i("7f7f"),i("7514"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"chapter-item",class:{element_hidden:!t.chapter.isPublished,"chapter-item-import":t.importContent,"chapter-item-remote":t.remoteContent},attrs:{"data-id":t.id}},[i("div",{staticClass:"chapter-description",class:{element_hidden:!t.chapter.isPublished}},[i("p",{staticClass:"chapter-title",attrs:{title:t.chapter.title}},[t._v("\n            "+t._s(this.chapter.shortTitle)+"\n        ")]),i("p",{staticClass:"header-info-wrapper"},[i("span",[t._v("\n                Kapitel\n            ")]),t.chapter.publication_date?i("span",[t._v("| veröffentlichen: "+t._s(t.chapter.publication_date))]):t._e(),t.chapter.withdraw_date?i("span",[t._v(" | widerrufen: "+t._s(t.chapter.withdraw_date))]):t._e()])]),i("div",{staticClass:"element-toolbar"},[i("button",{staticClass:"edit",on:{click:function(e){return t.editChapter(t.chapter)}}}),i("button",{staticClass:"trash",on:{click:function(e){return t.removeChapter(t.chapter)}}})]),i("ul",{staticClass:"subchapter-list",class:{"subchapter-list-import":t.importContent}},t._l(t.chapter.children,function(e){return i("SubchapterItem",{key:e.id,attrs:{subchapter:e,importContent:t.importContent,remoteContent:t.remoteContent}})}),1)])}),a=[],c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"subchapter-item",class:{element_hidden:!t.subchapter.isPublished,"subchapter-item-import":t.importContent,"subchapter-item-remote":t.remoteContent},attrs:{"data-id":t.id}},[i("div",{staticClass:"subchapter-description",class:{element_hidden:!t.subchapter.isPublished}},[i("p",{staticClass:"subchapter-title",attrs:{title:t.subchapter.title}},[t._v(t._s(t.subchapter.shortTitle))]),i("p",{staticClass:"header-info-wrapper"},[t._v("\n            Unterkapitel\n            "),t.subchapter.publication_date?i("span",[t._v(" | veröffentlichen: "+t._s(t.subchapter.publication_date))]):t._e(),t.subchapter.withdraw_date?i("span",[t._v(" | widerrufen: "+t._s(t.subchapter.withdraw_date))]):t._e()])]),i("ul",{staticClass:"section-list",class:{"section-list-import":t.importContent}},t._l(t.subchapter.children,function(e){return i("SectionItem",{key:e.id,attrs:{section:e,importContent:t.importContent,remoteContent:t.remoteContent}})}),1)])},l=[],u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"section-item",class:{element_hidden:!t.section.isPublished,"section-item-import":t.importContent,"section-item-remote":t.remoteContent},attrs:{"data-id":t.id}},[i("div",{staticClass:"section-description",class:{element_hidden:!t.section.isPublished}},[i("p",{staticClass:"section-title",attrs:{title:t.section.title}},[t._v(t._s(t.section.shortTitle))]),i("p",{staticClass:"header-info-wrapper"},[t._v("Abschnitt")])]),i("ul",{staticClass:"block-list",class:{"block-list-import":t.importContent}},t._l(t.section.children,function(e){return i("BlockItem",{key:e.id,attrs:{block:e,importContent:t.importContent,remoteContent:t.remoteContent}})}),1)])},d=[],p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"block-item",class:{element_hidden:!t.block.isPublished,"block-item-import":t.importContent,"block-item-remote":t.remoteContent},attrs:{"data-id":t.id}},[i("p",{staticClass:"block-description",class:{element_hidden:!t.block.isPublished}},[i("span",{class:["block-icon cw-block-icon-"+t.block.type]}),t._v("\n        "+t._s(t.block.readable_name)+"\n    ")]),i("ul",{staticClass:"block-preview",class:{"block-preview-import":t.importContent}},[i("li",{staticClass:"block-content-preview",domProps:{innerHTML:t._s(t.preview)}})])])},h=[],m={name:"BlockItem",data:function(){return{id:this.block.id,preview:""}},components:{},props:{block:Object,importContent:Boolean,remoteContent:Boolean},created:function(){this.preview=this.block.preview,this.importContent&&!this.remoteContent&&(this.id="import-"+this.id),this.importContent&&this.remoteContent&&(this.id="remote-"+this.id)}},b=m,f=i("2877"),g=Object(f["a"])(b,p,h,!1,null,"3d3278e4",null),C=g.exports,v={shortTitle:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return t.length>e?t.substr(0,e-1)+"…":t},test:function(t){t(42)}},_={name:"SectionItem",data:function(){return{id:this.section.id}},components:{BlockItem:C},props:{section:Object,importContent:Boolean,remoteContent:Boolean},created:function(){this.importContent&&!this.remoteContent&&(this.id="import-"+this.id),this.importContent&&this.remoteContent&&(this.id="remote-"+this.id),this.section.shortTitle=v.shortTitle(this.section.title,30)}},k=_,w=Object(f["a"])(k,u,d,!1,null,"7cfe31b8",null),S=w.exports,y={name:"SubchapterItem",data:function(){return{id:this.subchapter.id}},components:{SectionItem:S},props:{subchapter:Object,importContent:Boolean,remoteContent:Boolean},created:function(){this.importContent&&!this.remoteContent&&(this.id="import-"+this.id),this.importContent&&this.remoteContent&&(this.id="remote-"+this.id),this.subchapter.shortTitle=v.shortTitle(this.subchapter.title,30)}},D=y,A=Object(f["a"])(D,c,l,!1,null,"6b690e78",null),E=A.exports,I=null,O=null,L={createEditDialog:function(t){I=t},createRemoveDialog:function(t){O=t},useEditDialog:function(t,e,i){I.find("#editDialogElementId").val(t.id),I.find("#editDialogElementTitle").val(t.title),I.dialog({resizable:!1,title:t.title+" bearbeiten",height:"auto",width:"auto",modal:!0,buttons:{Speichern:function(){var r={};r.id=$(this).find("#editDialogElementId").val(),r.title=$(this).find("#editDialogElementTitle").val(),r=JSON.stringify(r),$.ajax({type:"PUT",url:"../blocks/"+t.id,contentType:"application/json",data:r,success:function(){e(r)},error:function(){i("can not store data!")}}),$(this).dialog("close")},Abbrechen:function(){$(this).dialog("destroy").hide()}},close:function(){$(this).dialog("destroy").hide()},create:function(){var t=$(this).parent().find(".ui-dialog-buttonset .ui-button");console.log(t),t.eq(0).addClass("accept"),t.eq(1).addClass("cancel")}})},useRemoveDialog:function(t,e,i){O.find("#editDialogElementId").val(t.id),O.find("#editDialogElementTitle").val(t.title),O.dialog({resizable:!1,title:t.title+" löschen",height:"auto",width:"auto",modal:!0,buttons:{Ja:function(){var r={};r.id=$(this).find("#editDialogElementId").val(),r=JSON.stringify(r),$.ajax({type:"DELETE",url:"../blocks/"+t.id,contentType:"application/json",data:r,success:function(){e(r)},error:function(){i("can not remove node!")}}),$(this).dialog("close")},Nein:function(){$(this).dialog("destroy").hide()}},close:function(){$(this).dialog("destroy").hide()},create:function(){var t=$(this).parent().find(".ui-dialog-buttonset .ui-button");console.log(t),t.eq(0).addClass("accept"),t.eq(1).addClass("cancel")}}).prev(".ui-dialog-titlebar").css("background","#d60000")}},B={name:"ChapterItem",data:function(){return{id:this.chapter.id}},components:{SubchapterItem:E},props:{chapter:Object,importContent:Boolean,remoteContent:Boolean},created:function(){this.importContent&&!this.remoteContent&&(this.id="import-"+this.id),this.importContent&&this.remoteContent&&(this.id="remote-"+this.id),this.chapter.shortTitle=v.shortTitle(this.chapter.title,30)},methods:{editChapter:function(t){var e=this;return new Promise(function(e,i){L.useEditDialog(t,e,i)}).then(function(t){t=JSON.parse(t),e.chapter.title=t.title,e.chapter.shortTitle=v.shortTitle(e.chapter.title,30)},function(t){console.log(t)})},removeChapter:function(t){var e=this;return new Promise(function(e,i){L.useRemoveDialog(t,e,i)}).then(function(t){t=JSON.parse(t),console.log(t),$("li[data-id="+e.chapter.id+"]").remove()},function(t){console.log(t)})}}},T=B,x=Object(f["a"])(T,n,a,!1,null,"2422e860",null),M=x.exports,P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"semester-item"},[i("p",{staticClass:"semester-description",on:{click:t.toggleList}},[t._v(t._s(t.semester_name))]),i("ul",{staticClass:"course-list"},t._l(t.courses,function(e){return i("CourseItem",{key:e.id,attrs:{course:e},on:{"course-selected":t.courseSelected}})}),1)])},j=[],N=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"course-item"},[i("button",{staticClass:"blockmanager-course-item",attrs:{"data-remote_cid":t.course.id,"data-remote_name":t.course.name},on:{click:function(e){return t.$emit("course-selected",{remoteName:t.course.name,remoteId:t.course.id})}}},[t._v("\n        "+t._s(t.course.name)+"\n    ")])])},J=[],R={name:"CourseItem",data:function(){return{}},components:{},props:{course:Object},methods:{}},F=R,z=Object(f["a"])(F,N,J,!1,null,"55eb924c",null),W=z.exports,U={name:"SemesterItem",components:{CourseItem:W},props:{courses:Array,semester_name:String},methods:{courseSelected:function(t){this.$emit("course-selected",t)},toggleList:function(t){$(t.target).siblings("ul").toggle(),$(t.target).hasClass("unfolded")?$(t.target).removeClass("unfolded"):$(t.target).addClass("unfolded")}}},q=U,X=Object(f["a"])(q,P,j,!1,null,"06db66f4",null),V=X.exports,G=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},H=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"editDialog",title:""}},[i("input",{attrs:{type:"hidden",id:"editDialogElementId"}}),i("label",{attrs:{for:"editDialogElementTitle"}},[t._v("Titel:")]),i("input",{attrs:{type:"text",id:"editDialogElementTitle",name:"editDialogElementTitle"}})])}],K={},Z=K,Q=Object(f["a"])(Z,G,H,!1,null,null,null),Y=Q.exports,tt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},et=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"removeDialog",title:""}},[i("input",{attrs:{type:"hidden",id:"removeDialogElementId"}}),i("p",{staticClass:"remove-question"},[t._v("Möchten Sie dieses Element und alle darunter liegenden Elemente wirklich löschen?")])])}],it={},rt=it,ot=Object(f["a"])(rt,tt,et,!1,null,null,null),st=ot.exports,nt={getContent:function(t){var e={};switch(t.getAttribute("type")){case"AssortBlock":return"";case"AudioBlock":return t.getAttribute("audio:audio_file_name");case"AudioGalleryBlock":return"";case"BeforeAfterBlock":return e=JSON.parse(t.getAttribute("beforeafter:ba_before")),"url"==e.source?e.url:e.file_name;case"BlubberBlock":return"";case"CanvasBlock":return e=JSON.parse(t.getAttribute("canvas:canvas_content")),"web"==e.source?e.image_url:"cw"==e.source?e.image_name:"";case"ChartBlock":return t.getAttribute("chart:chart_type");case"CodeBlock":return t.getAttribute("code:code_content");case"ConfirmBlock":return t.getAttribute("title");case"DateBlock":return e=JSON.parse(t.getAttribute("date:date_content")),e.date+" "+e.time;case"DialogCardsBlock":return e=JSON.parse(t.getAttribute("dialogcards:dialogcards_content")),e[0].front_img_file_name;case"DiscussionBlock":return"";case"EmbedBlock":return t.getAttribute("embed:embed_source")+" "+t.getAttribute("embed:embed_url");case"FolderBlock":return"";case"ForumBlock":return"";case"GalleryBlock":return t.getAttribute("gallery:gallery_folder_name");case"HtmlBlock":return t.textContent;case"IFrameBlock":return t.getAttribute("iframe:url");case"ImageMapBlock":return JSON.parse(t.getAttribute("imagemap:image_map_content")).image_name;case"InteractiveVideoBlock":return JSON.parse(t.getAttribute("interactivevideo:iav_source")).file_name;case"KeyPointBlock":return t.getAttribute("keypoint:keypoint_content");case"LinkBlock":return t.getAttribute("link:link_target");case"OpenCastBlock":return"";case"PdfBlock":return t.getAttribute("pdf:pdf_filename");case"PostBlock":return"";case"SearchBlock":return"";case"TestBlock":var i=t.getAttribute("test:xml"),r=new DOMParser,o=r.parseFromString(i,"text/xml");return o.firstElementChild.children[0].textContent;case"TypewriterBlock":return e=JSON.parse(t.getAttribute("typewriter:typewriter_json")),e.content;case"VideoBlock":return""!=t.getAttribute("video:webvideo")?(e=JSON.parse(t.getAttribute("video:webvideo"))[0],"url"==e.source?e.src:e.file_name):t.getAttribute("video:url");default:return""}}},at=i("bc3a"),ct=i.n(at),lt={name:"BlockManager",data:function(){return{courseware:{},remoteCourses:{},remoteCourseware:null,importCourseware:null,isDragging:!1,chapterList:[],subchapterList:{},sectionList:{},blockList:{},actionTitle:"Aktionen",courseImportText:"Aus Veranstaltung importieren",setDecontrolText:"Freigaben setzen",remoteData:!1,importData:!1,importMap:[],importXML:"",blockMap:null,fileError:!1}},components:{ChapterItem:M,SemesterItem:V,EditDialog:Y,RemoveDialog:st},created:function(){this.courseware=JSON.parse(COURSEWARE.data.courseware),this.remoteCourses=JSON.parse(COURSEWARE.data.remote_courses),this.blockMap=JSON.parse(COURSEWARE.data.block_map)},mounted:function(){this.startMouseListeners(),this.createSortables(),L.createEditDialog($("#editDialog")),L.createRemoveDialog($("#removeDialog"))},methods:{setDecontrol:function(){$("#cw-reset-action-menu").show(),$("#cw-action-selection").hide(),this.actionTitle=this.setDecontrolText},importFromCourse:function(){this.actionTitle=this.courseImportText,$("#cw-reset-action-menu").show(),$("#cw-action-selection").hide(),$("#user-course-list").show(),$(".semester-description").siblings("ul").hide()},resetActionMenu:function(t){$("#user-course-list").hide(),$(".cw-remote-courseware").hide(),$("#cw-import-lists").hide(),$("#cw-action-selection").show(),$("#cw-action-wrapper").find(".unfolded").removeClass("unfolded"),$(t.target).hide(),this.actionTitle="Aktionen",this.fileError=!1},startMouseListeners:function(){$(".chapter-description, .subchapter-description, .section-description, .block-description").mousedown(function(){this.isDragging=!1}).mousemove(function(){this.isDragging=!0}).mouseup(function(){var t=this.isDragging;this.isDragging=!1,t||($(this).siblings("ul, .element-toolbar").toggle(),$(this).hasClass("unfolded")?$(this).removeClass("unfolded"):$(this).addClass("unfolded"))})},stopMouseListeners:function(){$(".chapter-description, .subchapter-description, .section-description, .block-description").unbind()},createSortables:function(){var t=this;$(".chapter-list").sortable({connectWith:".chapter-list:not(.chapter-list-import)",placeholder:"highlight",start:function(t,e){e.placeholder.height(e.item.height())},update:function(e,i){t.chapterList=[],$(".chapter-list:not(.chapter-list-import) .chapter-item").each(function(e,i){t.chapterList.push($(i).data("id"))}),$(i.item).hasClass("chapter-item-import")&&(t.removeImportClasses($(i.item)),t.importSubchapters($(i.item)),t.importData=!0),$(i.item).hasClass("chapter-item-remote")&&(t.remoteData=!0),t.storeChanges()}}).disableSelection(),$(".subchapter-list").sortable({connectWith:".subchapter-list:not(.subchapter-list-import)",placeholder:"highlight",start:function(t,e){e.placeholder.height(e.item.height())},update:function(e,i){var r=$(i.item).parents(".chapter-item").first();t.subchapterList[r.data("id")]=[],$.each(t.subchapterList,function(e){var i=[];$('.chapter-item[data-id="'+e+'"]').find(".subchapter-item").each(function(t,e){i.push($(e).data("id"))}),i.length>0?t.subchapterList[e]=i:delete t.subchapterList[e]}),$(i.item).hasClass("subchapter-item-import")&&(t.removeImportClasses($(i.item)),t.importSections($(i.item)),t.importData=!0),$(i.item).hasClass("subchapter-item-remote")&&(t.remoteData=!0),$(i.item).parents(".chapter-item").hasClass("element_hidden")&&($(i.item).addClass("element_hidden"),$(i.item).find("p.subchapter-description").addClass("element_hidden")),t.storeChanges()}}).disableSelection(),$(".section-list").sortable({connectWith:".section-list:not(.section-list-import)",placeholder:"highlight",start:function(t,e){e.placeholder.height(e.item.height())},update:function(e,i){var r=$(i.item).parents(".subchapter-item").first();t.sectionList[r.data("id")]=[],$.each(t.sectionList,function(e){var i=[];$('.subchapter-item[data-id="'+e+'"]').find(".section-item").each(function(t,e){i.push($(e).data("id"))}),i.length>0?t.sectionList[e]=i:delete t.sectionList[e]}),$(i.item).hasClass("section-item-import")&&(t.removeImportClasses($(i.item)),t.importBlocks($(i.item)),t.importData=!0),$(i.item).hasClass("section-item-remote")&&(t.remoteData=!0),$(i.item).parents(".subchapter-item").hasClass("element_hidden")&&($(i.item).addClass("element_hidden"),$(i.item).find("p.section-description").addClass("element_hidden")),t.storeChanges()}}).disableSelection(),$(".block-list").sortable({connectWith:".block-list:not(.block-list-import)",placeholder:"highlight",start:function(t,e){e.placeholder.height(e.item.height()+20)},update:function(e,i){var r=$(i.item).parents(".section-item").first();t.blockList[r.data("id")]=[],$.each(t.blockList,function(e){var i=[];$('.section-item[data-id="'+e+'"]').find(".block-item").each(function(t,e){i.push($(e).attr("data-id"))}),i.length>0?t.blockList[e]=i:delete t.blockList[e]}),$(i.item).hasClass("block-item-import")&&(t.removeImportClasses($(i.item)),t.importData=!0),$(i.item).hasClass("block-item-remote")&&(t.remoteData=!0),$(i.item).parents(".section-item").hasClass("element_hidden")&&($(i.item).addClass("element_hidden"),$(i.item).find("p.block-description").addClass("element_hidden")),t.storeChanges()}}).disableSelection()},storeChanges:function(){var t=this,e=[],i={};if(t.importData&&!t.remoteData){var r=$("#cw-file-upload-import")[0].files[0],o=new Promise(function(t){var e=new FileReader;e.readAsDataURL(r),e.onloadend=function(){i.file=e.result,i.name=r.name,i.size=r.size,i.type=r.type,t(e.result)}});e.push(o)}Promise.all(e).then(function(){ct.a.post("store_changes_vue",{cid:COURSEWARE.config.cid,import:t.importData,remote:t.remoteData,importXML:t.importXML,chapterList:JSON.stringify(t.chapterList),subchapterList:JSON.stringify(t.subchapterList),sectionList:JSON.stringify(t.sectionList),blockList:JSON.stringify(t.blockList),fileData:i}).then(function(e){if($(".cw-blockmanager-store-icon").fadeIn(500,function(){$(this).delay(1e3).fadeOut(500)}),t.importData=!1,t.remoteData=!1,""!=e.data.remote_map){var i=JSON.parse(e.data.remote_map);t.changeRemoteIds(i)}}).catch(function(t){console.log("there was an error: "+t.response),$(".cw-blockmanager-store-icon-error").fadeIn(500)})})},changeRemoteIds:function(t){$.each(t.block_map,function(t,e){$('.block-item[data-id="'+t+'"]').not(".block-item-import").attr("data-id",e).removeClass("block-item-remote")}),this.blockList={}},removeImportClasses:function(t){var e="chapter-item-import chapter-list-import subchapter-item-import subchapter-list-import section-item-import section-list-import block-item-import block-list-import";t.removeClass(e),t.find(".chapter-item-import, .chapter-list-import, .subchapter-item-import, .subchapter-list-import, .section-item-import, .section-list-import, .block-item-import, .block-list-import").removeClass(e)},importBlocks:function(t){var e=this,i=t.attr("data-id"),r=t.find(".block-item"),o=[];$.each(r,function(){o.push($(this).attr("data-id"))}),o.length>0&&(e.blockList[i]=o)},importSections:function(t){var e=this,i=t.attr("data-id"),r=t.find(".section-item"),o=[];$.each(r,function(){o.push($(this).attr("data-id")),e.importBlocks($(this))}),o.length>0&&(e.sectionList[i]=o)},importSubchapters:function(t){var e=this,i=t.attr("data-id"),r=t.find(".subchapter-item"),o=[];$.each(r,function(){o.push($(this).attr("data-id")),e.importSections($(this))}),o.length>0&&(e.subchapterList[i]=o)},getRemoteCourse:function(t){var e=this;ct.a.get("get_remote_course",{params:{cid:COURSEWARE.config.cid,remote_cid:t.remoteId}}).then(function(t){e.remoteCourseware=t.data}).then(function(){e.actionTitle="Import: "+t.remoteName,e.createSortablesForImport(),e.stopMouseListeners(),e.startMouseListeners(),$("#cw-action-selection").hide(),$("#user-course-list").hide(),$(".cw-remote-courseware").show()}).catch(function(t){console.log("there was an error: "+t.response)})},createSortablesForImport:function(){$(".subchapter-list-import, .section-list-import, .block-list-import, .block-preview-import").hide(),$(".chapter-list-import").sortable({connectWith:".chapter-list",placeholder:"highlight",start:function(t,e){e.placeholder.height(e.item.height())},beforeStop:function(t,e){e.item.parent().hasClass("chapter-list-import")&&$(this).sortable("cancel")}}).disableSelection(),$(".subchapter-list-import").sortable({connectWith:".subchapter-list",placeholder:"highlight",start:function(t,e){e.placeholder.height(e.item.height())},beforeStop:function(t,e){e.item.parent().hasClass("subchapter-list-import")&&$(this).sortable("cancel")}}).disableSelection(),$(".section-list-import").sortable({connectWith:".section-list",placeholder:"highlight",start:function(t,e){e.placeholder.height(e.item.height())},beforeStop:function(t,e){e.item.parent().hasClass("section-list-import")&&$(this).sortable("cancel")}}).disableSelection(),$(".block-list-import").sortable({connectWith:".block-list",placeholder:"highlight",start:function(t,e){e.placeholder.height(e.item.height()+20)},beforeStop:function(t,e){e.item.parent().hasClass("block-list-import")&&$(this).sortable("cancel")}}).disableSelection()},setImport:function(){var t=this;t.fileError=!1;var e=event.target.files[0];$("#cw-blockmanager-form-full-import").css("display","inline-block"),$("#cw-reset-action-menu").show(),ZipLoader.unzip(e).then(function(e){var i,r,o;if(void 0!=e.files["data.xml"]){i=e.extractAsText("data.xml"),r=new DOMParser,o=r.parseFromString(i,"text/xml");var s=0,n=0,a=0;t.importCourseware=[],t.importCourseware["chapters"]=[],$.each(o.documentElement.children,function(e,i){if("chapter"==i.nodeName){s++,i.setAttribute("temp-id",s);var r=t.importCourseware["chapters"].push({title:i.getAttribute("title"),id:s,publication_date:!1,withdraw_date:!1,isPublished:!0}),o=t.importCourseware["chapters"][r-1];if("undefined"===typeof o)return!0;o.children=[],$.each(i.children,function(e,i){if("subchapter"==i.nodeName){n++,i.setAttribute("temp-id",n);var r=o.children.push({title:i.getAttribute("title"),id:n,publication_date:!1,withdraw_date:!1,isPublished:!0}),s=o.children[r-1];if("undefined"===typeof s)return!0;s.children=[],$.each(i.children,function(e,i){if("section"==i.nodeName){a++,i.setAttribute("temp-id",a);var r=s.children.push({title:i.getAttribute("title"),id:a,isPublished:!0}),o=s.children[r-1];if("undefined"===typeof o)return!0;o.children=[],$.each(i.children,function(e,i){"block"==i.nodeName&&o.children.push({type:i.getAttribute("type"),id:i.getAttribute("uuid"),isPublished:!0,preview:nt.getContent(i),readable_name:t.blockMap[i.getAttribute("type")]})})}})}})}});var c=new XMLSerializer;t.importXML=c.serializeToString(o)}else t.fileError=!0}).then(function(){t.createSortablesForImport(),t.stopMouseListeners(),t.startMouseListeners(),$(".subchapter-list-import, .section-list-import, .block-list-import").hide(),$("#cw-action-selection").hide(),t.fileError||$("#cw-import-lists").show(),t.actionTitle="Import: "+e.name+" ("+t.calcFileSize(e.size)+")"})},calcFileSize:function(t){return 0!=(t/1048576).toFixed(0)?(t/1048576).toFixed(1)+" MB":(t/1024).toFixed(1)+" kB"}}},ut=lt,dt=Object(f["a"])(ut,o,s,!1,null,"7aea7434",null),pt=dt.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(pt)}}).$mount("#block_mananger_content")}});
//# sourceMappingURL=index.97bd7b4c.js.map