(function(t){function e(e){for(var s,a,r=e[0],l=e[1],c=e[2],d=0,h=[];d<r.length;d++)a=r[d],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&h.push(n[a][0]),n[a]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);u&&u(e);while(h.length)h.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],s=!0,r=1;r<i.length;r++){var l=i[r];0!==n[l]&&(s=!1)}s&&(o.splice(e--,1),t=a(a.s=i[0]))}return t}var s={},n={index:0},o=[];function a(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=s,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="../../../plugins_packages/virtUOS/Courseware/views/block_manager/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("b635")},b635:function(t,e,i){"use strict";i.r(e);i("14c6"),i("08c1"),i("4842"),i("d9fc");var s=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"cw-blockmanager-content"}},[i("div",{staticClass:"cw-blockmanager-wrapper"},[i("div",{staticClass:"cw-blockmanager-title"},[i("p",[t._v(t._s(this.courseware.title))]),i("div",{staticClass:"cw-blockmanager-title-loading"},[t.storeLock?i("spring-spinner",{attrs:{"animation-duration":1e3,size:30,color:"#28497c"}}):t._e()],1),i("ActionMenuItem",{attrs:{buttons:["add-child"],element:this.courseware},on:{"add-child":t.addChild}})],1),i("draggable",t._b({staticClass:"chapter-list",attrs:{tag:"ul",list:t.chapters,group:{name:"chapters"},"ghost-class":"ghost",handle:".chapter-handle"},on:{sort:t.sortChapters,add:t.addChapter}},"draggable",t.storeLock?{disabled:!0}:{disabled:!1,animation:200},!1),t._l(this.chapters,function(e){return i("ChapterItem",{key:e.id,attrs:{element:e,importContent:!1,remoteContent:!1,storeLock:t.storeLock},on:{listUpdate:t.updateList,"remove-chapter":t.removeChapter,isRemote:t.isRemoteAction,isImport:t.isImportAction}})}),1)],1),i("div",{staticClass:"cw-blockmanager-wrapper",attrs:{id:"cw-action-wrapper"}},[i("div",{staticClass:"cw-blockmanager-title",attrs:{id:"cw-import-title"}},[i("p",[t._v(t._s(t.actionTitle))])]),t.fileError?i("div",{staticClass:"messagebox messagebox_error"},[t._v("\n            Das Archiv enthält keine Coursewaredaten\n        ")]):t._e(),!t.showRemoteCourseware||t.remoteCourseware||t.loading?t._e():i("div",{attrs:{id:"user-course-list"}},[i("ul",{staticClass:"semester-list"},t._l(this.remoteCourses,function(e,s){return i("SemesterItem",{key:s,attrs:{courses:e,semester_name:s},on:{"course-selected":t.getRemoteCourse}})}),1)]),t.showRemoteCourseware&&t.remoteCourseware?i("div",{staticClass:"cw-remote-courseware"},[i("draggable",t._b({staticClass:"chapter-list chapter-list-import",attrs:{tag:"ul",list:this.remoteCourseware.children,group:{name:"chapters",pull:"clone",put:!1},"ghost-class":"ghost",handle:".chapter-handle"},on:{clone:t.cloning}},"draggable",t.storeLock?{disabled:!0}:{disabled:!1,animation:200,sort:!1},!1),t._l(this.remoteCourseware.children,function(e){return i("ChapterItem",{key:e.id,attrs:{element:e,importContent:!0,remoteContent:!0,storeLock:t.storeLock}})}),1)],1):t._e(),t.showImportCourseware&&t.importCourseware?i("div",{attrs:{id:"cw-import-lists"}},[i("draggable",t._b({staticClass:"chapter-list chapter-list-import",attrs:{tag:"ul",list:this.importCourseware.chapters,group:{name:"chapters",pull:"clone",put:!1},"ghost-class":"ghost",handle:".chapter-handle"}},"draggable",t.storeLock?{disabled:!0}:{disabled:!1,animation:200,sort:!1},!1),t._l(this.importCourseware.chapters,function(e){return i("ChapterItem",{key:e.id,attrs:{element:e,importContent:!0,remoteContent:!1,storeLock:t.storeLock}})}),1)],1):t._e(),t.showRemoteCourseware||t.showImportCourseware?t._e():i("ul",{attrs:{id:"cw-action-selection"}},[i("li",[i("label",{staticClass:"cw-action-menu-button",attrs:{for:"cw-file-upload-import",id:"cw-file-upload-import-label",title:"Laden Sie eine Datei hoch, die Sie zuvor aus einer Courseware exportiert haben"}},[i("input",{staticClass:"cw-file-upload-import",attrs:{type:"file",name:"cw-file-upload-import",id:"cw-file-upload-import",accept:".zip"},on:{change:t.setImport}}),i("p",[t._v("Import-Archiv hochladen")])])]),i("li",[i("div",{staticClass:"cw-action-menu-button",attrs:{id:"cw-import-from-course",title:"Importieren Sie Inhalte aus einer anderen Veranstaltung in der Sie Dozent sind"},on:{click:t.importFromCourse}},[i("p",[t._v(t._s(t.courseImportText))])])])]),(t.showRemoteCourseware||t.showImportCourseware)&&t.loading?i("div",[i("spring-spinner",{staticClass:"cw-action-loading",attrs:{"animation-duration":3e3,size:65,color:"#28497c"}})],1):t._e(),!t.showRemoteCourseware&&!t.showImportCourseware||t.loading?t._e():i("button",{staticClass:"button",attrs:{id:"cw-reset-action-menu"},on:{click:t.resetActionMenu}},[t._v("\n            zurück zur Auswahl\n        ")]),i("div",{staticStyle:{clear:"both"}})])])},o=[],a=(i("e285"),i("c880"),i("0c1f"),i("2e73"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"chapter-item",class:{"chapter-item-import":t.importContent,"chapter-item-remote":t.remoteContent},attrs:{"data-id":t.id}},[i("div",{staticClass:"chapter-description chapter-handle",class:{"full-width":t.importContent||t.remoteContent,unfolded:t.unfolded},on:{click:t.toggleContent}},[i("p",{staticClass:"chapter-title",attrs:{title:t.title}},[t._v("\n            "+t._s(t.shortTitle)+"\n        ")]),i("p",{staticClass:"header-info-wrapper"},[i("span",{class:{"unpublished-info":!t.isPublished&&(t.publication_date||t.withdraw_date),"published-info":t.isPublished&&(t.publication_date||t.withdraw_date)}},[t._v("\n                Kapitel\n            ")]),!t.publication_date||this.importContent||this.remoteContent?t._e():i("span",{class:{"unpublished-info":!t.isPublished,"published-info":t.isPublished}},[t._v("| sichtbar ab: "+t._s(t.publication_date_readable))]),!t.withdraw_date||this.importContent||this.remoteContent?t._e():i("span",{class:{"unpublished-info":!t.isPublished,"published-info":t.isPublished}},[t._v("\n                | unsichtbar ab: "+t._s(t.withdraw_date_readable))])])]),this.importContent||this.remoteContent?t._e():i("ActionMenuItem",{class:{unfolded:t.unfolded},attrs:{buttons:["edit","remove","groups","users","add-child"],element:this.element},on:{edit:t.editElement,remove:t.removeElement,"add-child":t.addChild,"set-users":t.setUserApproval,"set-groups":t.setGroupApproval}}),t.unfolded?i("draggable",t._b({staticClass:"subchapter-list",class:{"subchapter-list-import":t.importContent},attrs:{tag:"ul",list:t.subchapters,group:t.draggableGroup,"ghost-class":"ghost",handle:".subchapter-handle"},on:{sort:t.sortSubchapters}},"draggable",t.dragOptions,!1),[t._l(t.subchapters,function(e){return i("SubchapterItem",{key:e.id,attrs:{element:e,importContent:t.importContent,remoteContent:t.remoteContent,storeLock:t.storeLock},on:{listUpdate:t.updateList,"remove-subchapter":t.removeSubchapter,isRemote:t.isRemoteAction,isImport:t.isImportAction}})}),0==t.subchapters.length?i("p",[t._v("\n            This Chapter is empty.\n            "),t.importContent?t._e():i("span",[t._v("You can drop a subchapter here or add a new one.")])]):t._e()],2):t._e()],1)}),r=[],l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"subchapter-item",class:{"subchapter-item-import":t.importContent,"subchapter-item-remote":t.remoteContent},attrs:{"data-id":t.id}},[i("div",{staticClass:"subchapter-description subchapter-handle",class:{"full-width":t.importContent||t.remoteContent,unfolded:t.unfolded},on:{click:t.toggleContent}},[i("p",{staticClass:"subchapter-title",attrs:{title:t.title}},[t._v(t._s(t.shortTitle))]),i("p",{staticClass:"header-info-wrapper"},[i("span",{class:{"unpublished-info":!t.isPublished&&(t.publication_date||t.withdraw_date),"published-info":t.isPublished&&(t.publication_date||t.withdraw_date)}},[t._v("\n                Unterkapitel\n            ")]),t.publication_date?i("span",{class:{"unpublished-info":!t.isPublished,"published-info":t.isPublished}},[t._v("\n                | sichtbar ab: "+t._s(t.publication_date_readable))]):t._e(),t.withdraw_date?i("span",{class:{"unpublished-info":!t.isPublished,"published-info":t.isPublished}},[t._v("\n                | unsichtbar ab: "+t._s(t.withdraw_date_readable))]):t._e()])]),this.importContent||this.remoteContent?t._e():i("ActionMenuItem",{class:{unfolded:t.unfolded},attrs:{buttons:["edit","remove","groups","users","add-child"],element:this.element},on:{edit:t.editElement,remove:t.removeElement,"add-child":t.addChild,"set-users":t.setUserApproval,"set-groups":t.setGroupApproval}}),t.unfolded?i("draggable",t._b({staticClass:"section-list",class:{"section-list-import":t.importContent},attrs:{tag:"ul",list:t.sections,group:t.draggableGroup,"ghost-class":"ghost",handle:".section-handle"},on:{sort:t.sortSections}},"draggable",t.dragOptions,!1),[t._l(t.sections,function(e){return i("SectionItem",{key:e.id,attrs:{element:e,importContent:t.importContent,remoteContent:t.remoteContent,storeLock:t.storeLock},on:{listUpdate:t.updateList,"remove-section":t.removeSection,isRemote:t.isRemoteAction,isImport:t.isImportAction}})}),0==t.sections.length?i("p",[t._v("\n            This Subchapter is empty.\n            "),t.importContent?t._e():i("span",[t._v("You can drop a section here or add a new one.")])]):t._e()],2):t._e()],1)},c=[],u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"section-item",class:{"section-item-import":t.importContent,"section-item-remote":t.remoteContent},attrs:{"data-id":t.id}},[i("div",{staticClass:"section-description section-handle",class:{"full-width":t.importContent||t.remoteContent,unfolded:t.unfolded},on:{click:t.toggleContent}},[i("p",{staticClass:"section-title",attrs:{title:t.title}},[t._v(t._s(t.shortTitle))]),i("p",{staticClass:"header-info-wrapper"},[t._v("Abschnitt")])]),this.importContent||this.remoteContent?t._e():i("ActionMenuItem",{class:{unfolded:t.unfolded},attrs:{buttons:["edit","remove"],element:this.element},on:{edit:t.editSection,remove:t.removeElement}}),t.unfolded?i("draggable",t._b({staticClass:"block-list",class:{"block-list-import":t.importContent},attrs:{tag:"ul",list:t.blocks,group:t.draggableGroup,"ghost-class":"ghost",handle:".block-handle"},on:{sort:t.sortBlocks}},"draggable",t.dragOptions,!1),[t._l(t.blocks,function(e){return i("BlockItem",{key:e.id,attrs:{block:e,importContent:t.importContent,remoteContent:t.remoteContent},on:{"remove-block":t.removeBlock,isRemote:t.isRemoteAction}})}),0==t.blocks.length?i("p",[t._v("\n            This Section is empty.\n            "),t.importContent?t._e():i("span",[t._v("You can add Block in Courseware or drop on here.")])]):t._e()],2):t._e()],1)},d=[],h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"block-item",class:{element_hidden:!t.block.isPublished,"block-item-import":t.importContent,"block-item-remote":t.remoteContent},attrs:{"data-id":t.id}},[i("div",{staticClass:"block-description block-handle",class:{element_hidden:!t.block.isPublished,unfolded:t.unfolded},on:{click:t.toggleContent}},[i("span",{class:["block-icon cw-block-icon-"+t.block.type]}),t._v("\n        "+t._s(t.block.readable_name)+"\n    ")]),this.importContent||this.remoteContent?t._e():i("ActionMenuItem",{attrs:{buttons:["remove"],element:this.block},on:{remove:t.removeElement}}),t.unfolded?i("ul",{staticClass:"block-preview",class:{"block-preview-import":t.importContent}},[i("li",{staticClass:"block-content-preview",domProps:{innerHTML:t._s(t.preview)}})]):t._e()],1)},m=[],p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"strucutal-element-menu-wrapper"},[i("nav",{staticClass:"action-menu bymousedown strucutal-element-menu"},[t._m(0),i("div",{staticClass:"action-menu-content"},[i("div",{staticClass:"action-menu-title"},[t._v("\n                Aktionen\n            ")]),i("ul",{staticClass:"action-menu-list"},[this.users_button?i("li",{staticClass:"action-menu-item"},[i("a",{staticClass:"set-users",attrs:{href:"#"},on:{click:function(e){return t.$emit("set-users")}}},[t._v("Schreibrechte für Studierenden setzen")])]):t._e(),this.groups_button?i("li",{staticClass:"action-menu-item"},[i("a",{staticClass:"set-groups",attrs:{href:"#"},on:{click:function(e){return t.$emit("set-groups")}}},[t._v("Schreibrechte für Gruppen setzen")])]):t._e(),this.edit_button?i("li",{staticClass:"action-menu-item"},[i("a",{staticClass:"edit-element",attrs:{href:"#"},on:{click:function(e){t.editDialogVisible=!0}}},[t._v("Element bearbeiten")])]):t._e(),this.remove_button?i("li",{staticClass:"action-menu-item"},[i("a",{staticClass:"remove-element",attrs:{href:"#"},on:{click:function(e){t.removeDialogVisible=!0}}},[t._v("Element löschen")])]):t._e(),this.add_child_button?i("li",{staticClass:"action-menu-item"},[i("a",{staticClass:"add-child-element",attrs:{href:"#"},on:{click:function(e){t.addChildDialogVisible=!0}}},[t._v("Unterelement hinzufügen")])]):t._e()])])]),i("RemoveDialog",{attrs:{DialogVisible:this.removeDialogVisible,element:this.element},on:{close:function(e){t.removeDialogVisible=!1},remove:function(e){return t.$emit("remove")}}}),i("EditDialog",{attrs:{DialogVisible:this.editDialogVisible,element:this.element},on:{close:function(e){t.editDialogVisible=!1},edit:t.editDialogAction}}),i("AddChildDialog",{attrs:{DialogVisible:this.addChildDialogVisible,element:this.element},on:{close:function(e){t.addChildDialogVisible=!1},"add-child":t.addChildDialogAction}})],1)},b=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",{staticClass:"action-menu-icon",attrs:{title:"Aktionen","aria-expanded":"true","aria-label":"Aktionsmenü",href:"#"}},[i("div"),i("div"),i("div")])}],f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return this.visible?i("div",{staticClass:"cw-dialog"},[i("transition",{attrs:{name:"modal-fade"}},[i("div",{staticClass:"modal-backdrop"},[i("div",{staticClass:"modal alert",attrs:{role:"dialog"}},[i("header",{staticClass:"modal-header"},[t._t("header",[t._v("\n                        "+t._s(this.title)+" löschen\n                        "),i("span",{staticClass:"modal-close-button",on:{click:t.close}})])],2),i("section",{staticClass:"modal-body"},[this.currentElement.isStrucutalElement?i("p",[t._v("\n                        Möchten Sie dieses Element und alle darunter liegenden Elemente wirklich löschen?\n                    ")]):t._e(),this.currentElement.isBlock?i("p",[t._v("\n                        Möchten Sie dieses Element wirklich löschen?\n                    ")]):t._e()]),i("footer",{staticClass:"modal-footer"},[t._t("footer",[t.deleting?i("button",{staticClass:"button modal-progress",attrs:{type:"button"}},[i("spring-spinner",{staticClass:"modal-progress-spinner",attrs:{"animation-duration":3e3,size:14,color:"#28497c"}})],1):i("button",{staticClass:"button accept",attrs:{type:"button"},on:{click:t.remove}},[t._v("\n                            Ja\n                        ")]),i("button",{staticClass:"button cancel",class:{"button-inactive":t.deleting},attrs:{type:"button"},on:{click:t.close}},[t._v("\n                            Nein\n                        ")])])],2)])])])],1):t._e()},g=[],_=i("4583"),C={name:"RemoveDialog",components:{SpringSpinner:_["a"]},props:{DialogVisible:Boolean,element:Object},data:function(){return{visible:this.DialogVisible,title:"",currentElement:this.element,deleting:!1}},mounted:function(){this.currentElement&&(this.currentElement.isBlock&&(this.title=this.currentElement.readable_name),this.currentElement.isStrucutalElement&&(this.title=this.currentElement.title))},methods:{close:function(){this.deleting||this.$emit("close")},remove:function(){var t={},e=this;t.id=this.currentElement.id,this.deleting=!0,$.ajax({type:"DELETE",url:"../blocks/"+t.id,contentType:"application/json",data:t,success:function(){e.$emit("remove"),e.deleting=!1,e.$emit("close")},error:function(){console.log("can not remove node!"),e.deleting=!1,e.$emit("close")}})}},watch:{DialogVisible:function(){this.visible=this.DialogVisible}}},v=C,w=i("2877"),k=Object(w["a"])(v,f,g,!1,null,null,null),D=k.exports,y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return this.visible?i("div",{staticClass:"cw-dialog"},[i("transition",{attrs:{name:"modal-fade"}},[i("div",{staticClass:"modal-backdrop"},[i("div",{staticClass:"modal",attrs:{role:"dialog"}},[i("header",{staticClass:"modal-header"},[t._t("header",[t._v("\n                        "+t._s(this.title)+" bearbeiten\n                        "),i("span",{staticClass:"modal-close-button",on:{click:t.close}})])],2),i("section",{staticClass:"modal-body"},[i("label",{attrs:{for:"editDialogElementTitle"}},[t._v("Titel:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",name:"editDialogElementTitle"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),i("br"),t.isChapter?i("div",[i("label",{attrs:{for:"publication_date"}},[t._v("sichtbar ab:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.publicationDate,expression:"publicationDate"}],attrs:{type:"date",name:"publication_date",max:t.maxPublicationDate},domProps:{value:t.publicationDate},on:{input:function(e){e.target.composing||(t.publicationDate=e.target.value)}}}),i("br"),i("label",{attrs:{for:"withdraw_date"}},[t._v("unsichtbar ab:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.withdrawDate,expression:"withdrawDate"}],attrs:{type:"date",name:"withdraw_date",min:t.minWithdrawDate},domProps:{value:t.withdrawDate},on:{input:function(e){e.target.composing||(t.withdrawDate=e.target.value)}}})]):t._e()]),i("footer",{staticClass:"modal-footer"},[t._t("footer",[i("button",{staticClass:"button accept",attrs:{type:"button"},on:{click:t.edit}},[t._v("\n                            Speichern\n                        ")]),i("button",{staticClass:"button cancel",attrs:{type:"button"},on:{click:t.close}},[t._v("\n                            Abbrechen\n                        ")])])],2)])])])],1):t._e()},A=[],E=(i("ae66"),{name:"EditDialog",props:{DialogVisible:Boolean,element:Object},data:function(){return{visible:this.DialogVisible,title:"",currentElement:this.element,isChapter:!1,publicationDate:null,maxPublicationDate:"",withdrawDate:null,minWithdrawDate:""}},mounted:function(){this.currentElement&&(this.title=this.currentElement.title,"Chapter"!=this.currentElement.type&&"Subchapter"!=this.currentElement.type||(this.isChapter=!0,this.currentElement.publication_date&&(this.publicationDate=this.convertTimestampToDate(this.currentElement.publication_date)),this.currentElement.withdraw_date&&(this.withdrawDate=this.convertTimestampToDate(this.currentElement.withdraw_date))))},methods:{close:function(){this.$emit("close")},edit:function(){var t=this,e={};if(e.id=this.element.id,e.title=this.title,this.isChapter){var i=/(\d{4})-(\d{2})-(\d{2})/;if(this.publicationDate&&(e.publication_date=new Date(this.publicationDate.replace(i,"$2,$3,$1")).getTime()/1e3,e.publication_date_readable=this.publicationDate.replace(i,"$3.$2.$1")),this.withdrawDate&&(e.withdraw_date=new Date(this.withdrawDate.replace(i,"$2,$3,$1")).getTime()/1e3,e.withdraw_date_readable=this.withdrawDate.replace(i,"$3.$2.$1")),e.withdraw_date<=e.publication_date)return;e.isPublished=this.isPublished(this.publicationDate,this.withdrawDate)}$.ajax({type:"PUT",url:"../blocks/"+e.id,contentType:"application/json",data:JSON.stringify(e),success:function(){t.$emit("edit",e),t.$emit("close")},error:function(){console.log("can not remove node!"),t.$emit("close")}})},convertTimestampToDate:function(t){var e=new Date(t);return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)},isPublished:function(t,e){var i=new Date;return(new Date(t)<i||null==t)&&(new Date(e)>i||null==e)}},watch:{DialogVisible:function(){this.visible=this.DialogVisible},publicationDate:function(){this.minWithdrawDate=this.convertTimestampToDate(this.publicationDate)},withdrawDate:function(){this.maxPublicationDate=this.convertTimestampToDate(this.withdrawDate)}}}),L=E,I=Object(w["a"])(L,y,A,!1,null,null,null),S=I.exports,O=function(){var t=this,e=t.$createElement,i=t._self._c||e;return this.visible?i("div",{staticClass:"cw-dialog"},[i("transition",{attrs:{name:"modal-fade"}},[i("div",{staticClass:"modal-backdrop"},[i("div",{staticClass:"modal",attrs:{role:"dialog"}},[i("header",{staticClass:"modal-header"},[t._t("header",[t._v("\n                        Unterelement hinzufügen\n                        "),i("span",{staticClass:"modal-close-button",on:{click:t.close}})])],2),i("section",{staticClass:"modal-body"},[i("label",{attrs:{for:"editDialogElementTitle"}},[t._v("Titel:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],ref:"editDialogElementTitle",attrs:{type:"text",name:"editDialogElementTitle"},domProps:{value:t.title},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.edit(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.close(e)}],input:function(e){e.target.composing||(t.title=e.target.value)}}})]),i("footer",{staticClass:"modal-footer"},[t._t("footer",[i("button",{staticClass:"button accept",attrs:{type:"button"},on:{click:t.edit}},[t._v("\n                            Speichern\n                        ")]),i("button",{staticClass:"button cancel",attrs:{type:"button"},on:{click:t.close}},[t._v("\n                            Abbrechen\n                        ")])])],2)])])])],1):t._e()},T=[],x=i("bc3a"),B=i.n(x),P={name:"AddChildDialog",props:{DialogVisible:Boolean,element:Object},data:function(){return{visible:this.DialogVisible,type:this.element.childType,title:"",currentElement:this.element}},mounted:function(){},methods:{close:function(){this.$emit("close"),this.title=""},edit:function(){var t=this;""==this.title&&(this.title="new "+this.type),B.a.post("add_structure",{parent:t.element.id,title:t.title,type:t.type,cid:COURSEWARE.config.cid}).then(function(e){t.$emit("add-child",e.data),t.close()}).catch(function(e){console.log("there was an error: "+e.response),t.close()})}},watch:{DialogVisible:function(){var t=this;this.visible=this.DialogVisible,this.$nextTick(function(){t.$refs.editDialogElementTitle&&t.$refs.editDialogElementTitle.focus()})}}},R=P,j=Object(w["a"])(R,O,T,!1,null,null,null),M=j.exports,N={props:{buttons:Array,element:Object},components:{RemoveDialog:D,EditDialog:S,AddChildDialog:M},data:function(){return{edit_button:!1,remove_button:!1,groups_button:!1,users_button:!1,add_child_button:!1,removeDialogVisible:!1,editDialogVisible:!1,addChildDialogVisible:!1}},created:function(){var t=this;this.buttons.forEach(function(e){switch(e){case"edit":t.edit_button=!0;break;case"remove":t.remove_button=!0;break;case"add-child":t.add_child_button=!0;break;case"groups":t.groups_button=!0;break;case"users":t.users_button=!0;break}})},methods:{editDialogAction:function(t){this.$emit("edit",t)},addChildDialogAction:function(t){this.$emit("add-child",t)}}},V=N,U=Object(w["a"])(V,p,b,!1,null,null,null),z=U.exports,J={name:"BlockItem",data:function(){return{id:this.block.id,preview:"",unfolded:!1}},components:{ActionMenuItem:z},props:{block:Object,importContent:Boolean,remoteContent:Boolean},created:function(){this.preview=this.block.preview},watch:{block:function(){this.id=this.block.id}},methods:{removeElement:function(){this.$emit("remove-block",this.block)},toggleContent:function(){this.unfolded=!this.unfolded}}},G=J,F=Object(w["a"])(G,h,m,!1,null,null,null),W=F.exports,Z={methods:{cutTitle:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return t.length>e?t.substr(0,e-1)+"…":t},getReadableDate:function(t){var e=new Date(t);return("0"+e.getDate()).slice(-2)+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+e.getFullYear()},getContent:function(t){var e={};switch(t.getAttribute("type")){case"AssortBlock":return"";case"AudioBlock":return t.getAttribute("audio:audio_file_name");case"AudioGalleryBlock":return"";case"BeforeAfterBlock":return e=JSON.parse(t.getAttribute("beforeafter:ba_before")),"url"==e.source?e.url:e.file_name;case"BlubberBlock":return"";case"CanvasBlock":return e=JSON.parse(t.getAttribute("canvas:canvas_content")),"web"==e.source?e.image_url:"cw"==e.source?e.image_name:"";case"ChartBlock":return t.getAttribute("chart:chart_type");case"CodeBlock":return t.getAttribute("code:code_content");case"ConfirmBlock":return t.getAttribute("title");case"DateBlock":return e=JSON.parse(t.getAttribute("date:date_content")),e.date+" "+e.time;case"DialogCardsBlock":return e=JSON.parse(t.getAttribute("dialogcards:dialogcards_content")),e[0].front_img_file_name;case"DiscussionBlock":return"";case"EmbedBlock":return t.getAttribute("embed:embed_source")+" "+t.getAttribute("embed:embed_url");case"FolderBlock":return"";case"ForumBlock":return"";case"GalleryBlock":return t.getAttribute("gallery:gallery_folder_name");case"HtmlBlock":return t.textContent;case"IFrameBlock":return t.getAttribute("iframe:url");case"ImageMapBlock":return JSON.parse(t.getAttribute("imagemap:image_map_content")).image_name;case"InteractiveVideoBlock":return JSON.parse(t.getAttribute("interactivevideo:iav_source")).file_name;case"KeyPointBlock":return t.getAttribute("keypoint:keypoint_content");case"LinkBlock":return t.getAttribute("link:link_target");case"OpenCastBlock":return"";case"PdfBlock":return t.getAttribute("pdf:pdf_filename");case"PostBlock":return"";case"SearchBlock":return"";case"TestBlock":var i=t.getAttribute("test:xml"),s=new DOMParser,n=s.parseFromString(i,"text/xml");return n.firstElementChild.children[0].textContent;case"TypewriterBlock":return e=JSON.parse(t.getAttribute("typewriter:typewriter_json")),e.content;case"VideoBlock":return""!=t.getAttribute("video:webvideo")?(e=JSON.parse(t.getAttribute("video:webvideo"))[0],"url"==e.source?e.src:e.file_name):t.getAttribute("video:url");default:return""}}}},X=i("310e"),Y=i.n(X),q={name:"SectionItem",mixins:[Z],data:function(){return{id:this.element.id,title:this.element.title,shortTitle:this.element.shortTitle,unfolded:!1,blocks:this.element.children,blockList:{},draggableGroup:{name:"blocks"}}},components:{BlockItem:W,ActionMenuItem:z,draggable:Y.a},props:{element:Object,importContent:Boolean,remoteContent:Boolean,storeLock:Boolean},created:function(){null==this.blocks&&(this.blocks=[]),this.importContent&&(this.draggableGroup={name:"blocks",pull:"clone",put:!1}),this.shortTitle=this.cutTitle(this.element.title,30)},watch:{element:function(){null==this.element.children?this.blocks=[]:this.blocks=this.element.children}},methods:{sortBlocks:function(){var t=this,e={},i=[],s=[];this.blocks.forEach(function(e){e.isRemote?(s.push("remote_"+e.id),t.$emit("isRemote")):e.isImport?(s.push("import_"+e.id),t.$emit("isImport")):s.push(e.id)}),i[this.id]=s,e.list=i,e.type="block",this.$emit("listUpdate",e)},removeBlock:function(t){var e=[];this.blocks.forEach(function(i){i.id!=t.id&&e.push(i)}),this.blocks=e},removeElement:function(){this.$emit("remove-section",this.element)},editSection:function(t){this.title=t.title,this.shortTitle=this.cutTitle(t.title,30)},toggleContent:function(){this.unfolded=!this.unfolded}},computed:{dragOptions:function(){return this.importContent?{animation:200,disabled:this.storeLock,sort:!1,ghostClass:"ghost"}:{animation:200,disabled:this.storeLock,ghostClass:"ghost"}}}},H=q,K=Object(w["a"])(H,u,d,!1,null,null,null),Q=K.exports,tt={name:"SubchapterItem",mixins:[Z],data:function(){return{id:this.element.id,publication_date:this.element.publication_date,publication_date_readable:this.getReadableDate(this.element.publication_date),withdraw_date:this.element.withdraw_date,withdraw_date_readable:this.getReadableDate(this.element.withdraw_date),isPublished:this.element.isPublished,title:this.element.title,shortTitle:this.element.shortTitle,unfolded:!1,sections:this.element.children,sectionList:{},draggableGroup:{name:"sections"}}},components:{SectionItem:Q,ActionMenuItem:z,draggable:Y.a},props:{element:Object,importContent:Boolean,remoteContent:Boolean,storeLock:Boolean},created:function(){null==this.sections&&(this.sections=[]),this.importContent&&(this.draggableGroup={name:"sections",pull:"clone",put:!1}),this.shortTitle=this.cutTitle(this.element.title,30)},watch:{element:function(){null==this.element.children?this.sections=[]:this.sections=this.element.children}},methods:{sortSections:function(){var t=this,e={},i=[],s=[],n=!1;this.sections.forEach(function(e){e.isRemote?(s.push("remote_"+e.id),t.isRemoteAction(),null!=e.children&&(n=!0,t.buildChildrenList(e,"remote_"))):e.isImport?(s.push("import_"+e.id),t.isImportAction(),null!=e.children.length&&(n=!0,t.buildChildrenList(e,"import_"))):s.push(e.id)}),i[this.id]=s,e.list=i,e.hasChildren=n,e.type="section",this.$emit("listUpdate",e)},buildChildrenList:function(t,e){var i=this,s=[],n=[],o={},a=!1;t.children.forEach(function(t){s.push(e+t.id),null!=t.children&&(a=!0,i.buildChildrenList(t,e))}),n[e+t.id]=s,o.list=n,o.hasChildren=a,"section"==t.type.toLowerCase()?(o.type="block",this.$emit("listUpdate",o)):(o.type=t.children[0].type.toLowerCase(),this.$emit("listUpdate",o))},updateList:function(t){this.$emit("listUpdate",t)},isRemoteAction:function(){this.$emit("isRemote")},isImportAction:function(){this.$emit("isImport")},removeElement:function(){this.$emit("remove-subchapter",this.element)},editElement:function(t){this.title=t.title,this.shortTitle=this.cutTitle(t.title),this.publication_date=1e3*t.publication_date,this.publication_date_readable=t.publication_date_readable,this.withdraw_date=1e3*t.withdraw_date,this.withdraw_date_readable=t.withdraw_date_readable,this.isPublished=t.isPublished},addChild:function(t){this.sections.push(t)},removeSection:function(t){var e=[];this.sections.forEach(function(i){i.id!=t.id&&e.push(i)}),this.sections=e},setUserApproval:function(t){console.log(t)},setGroupApproval:function(t){console.log(t)},toggleContent:function(){this.unfolded=!this.unfolded}},computed:{dragOptions:function(){return this.importContent?{animation:200,disabled:this.storeLock,sort:!1,ghostClass:"ghost"}:{animation:200,disabled:this.storeLock,ghostClass:"ghost"}}}},et=tt,it=Object(w["a"])(et,l,c,!1,null,null,null),st=it.exports,nt={name:"ChapterItem",mixins:[Z],props:{element:Object,importContent:Boolean,remoteContent:Boolean,storeLock:Boolean},data:function(){return{id:this.element.id,publication_date:this.element.publication_date,publication_date_readable:this.getReadableDate(this.element.publication_date),withdraw_date:this.element.withdraw_date,withdraw_date_readable:this.getReadableDate(this.element.withdraw_date),isPublished:this.element.isPublished,title:this.element.title,shortTitle:this.cutTitle(this.element.title,30),unfolded:!1,subchapters:this.element.children,subchapterList:[],draggableGroup:{name:"subchapters"}}},components:{SubchapterItem:st,ActionMenuItem:z,draggable:Y.a},created:function(){null==this.subchapters&&(this.subchapters=[]),this.importContent&&(this.draggableGroup={name:"subchapters",pull:"clone",put:!1})},watch:{element:function(){null==this.element.children?this.subchapters=[]:this.subchapters=this.element.children}},methods:{sortSubchapters:function(){var t=this,e={},i=[],s=[],n=!1;this.subchapters.forEach(function(e){e.isRemote?(s.push("remote_"+e.id),t.isRemoteAction(),null!=e.children&&(n=!0,t.buildChildrenList(e,"remote_"))):e.isImport?(s.push("import_"+e.id),t.isImportAction(),null!=e.children&&(n=!0,t.buildChildrenList(e,"import_"))):s.push(e.id)}),i[this.id]=s,e.list=i,e.hasChildren=n,e.type="subchapter",this.$emit("listUpdate",e)},buildChildrenList:function(t,e){var i=this,s=[],n=[],o={},a=!1;t.children.forEach(function(t){s.push(e+t.id),null!=t.children&&(a=!0,i.buildChildrenList(t,e))}),n[e+t.id]=s,o.list=n,o.hasChildren=a,"section"==t.type.toLowerCase()?(o.type="block",this.$emit("listUpdate",o)):(o.type=t.children[0].type.toLowerCase(),this.$emit("listUpdate",o))},isRemoteAction:function(){this.$emit("isRemote")},isImportAction:function(){this.$emit("isImport")},updateList:function(t){this.$emit("listUpdate",t)},removeElement:function(){this.$emit("remove-chapter",this.element)},editElement:function(t){this.title=t.title,this.shortTitle=this.cutTitle(t.title),this.publication_date=1e3*t.publication_date,this.publication_date_readable=t.publication_date_readable,this.withdraw_date=1e3*t.withdraw_date,this.withdraw_date_readable=t.withdraw_date_readable,this.isPublished=t.isPublished},addChild:function(t){this.subchapters.push(t)},removeSubchapter:function(t){var e=[];this.subchapters.forEach(function(i){i.id!=t.id&&e.push(i)}),this.subchapters=e},setUserApproval:function(t){console.log(t)},setGroupApproval:function(t){console.log(t)},toggleContent:function(){this.unfolded=!this.unfolded}},computed:{dragOptions:function(){return this.importContent?{animation:200,disabled:this.storeLock,sort:!1,ghostClass:"ghost"}:{animation:200,disabled:this.storeLock,ghostClass:"ghost"}}}},ot=nt,at=Object(w["a"])(ot,a,r,!1,null,null,null),rt=at.exports,lt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"semester-item"},[i("p",{staticClass:"semester-description",class:{unfolded:t.unfolded},on:{click:t.toggleList}},[t._v("\n        "+t._s(t.semester_name)+"\n    ")]),t.unfolded?i("ul",{staticClass:"course-list"},t._l(t.courses,function(e){return i("CourseItem",{key:e.id,attrs:{course:e},on:{"course-selected":t.courseSelected}})}),1):t._e()])},ct=[],ut=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"course-item"},[i("button",{staticClass:"blockmanager-course-item",attrs:{"data-remote_cid":t.course.id,"data-remote_name":t.course.name},on:{click:function(e){return t.$emit("course-selected",{remoteName:t.course.name,remoteId:t.course.id})}}},[t._v("\n        "+t._s(t.course.name)+"\n    ")])])},dt=[],ht={name:"CourseItem",data:function(){return{}},components:{},props:{course:Object},methods:{}},mt=ht,pt=Object(w["a"])(mt,ut,dt,!1,null,"991941d8",null),bt=pt.exports,ft={name:"SemesterItem",components:{CourseItem:bt},props:{courses:Array,semester_name:String},data:function(){return{unfolded:!1}},methods:{courseSelected:function(t){this.$emit("course-selected",t)},toggleList:function(){this.unfolded=!this.unfolded}}},gt=ft,_t=Object(w["a"])(gt,lt,ct,!1,null,"62099320",null),Ct=_t.exports,vt={name:"BlockManager",mixins:[Z],components:{ChapterItem:rt,SemesterItem:Ct,draggable:Y.a,ActionMenuItem:z,SpringSpinner:_["a"]},data:function(){return{courseware:{},remoteCourses:{},remoteCourseware:null,importCourseware:null,showRemoteCourseware:!1,showImportCourseware:!1,chapters:{},chapterList:[],subchapterList:{},sectionList:{},blockList:{},actionTitle:"Aktionen",courseImportText:"Aus Veranstaltung importieren",remoteData:!1,importData:!1,importXML:"",importZIP:"",blockMap:null,fileError:!1,loading:!1,storeLock:!1}},created:function(){this.courseware=JSON.parse(COURSEWARE.data.courseware),this.remoteCourses=JSON.parse(COURSEWARE.data.remote_courses),this.blockMap=JSON.parse(COURSEWARE.data.block_map)},mounted:function(){},watch:{courseware:function(){this.chapters=this.courseware.children}},methods:{sortChapters:function(){var t=this,e=!1;this.cleanLists(),this.chapters.forEach(function(i){i.isRemote?(t.chapterList.push("remote_"+i.id),t.isRemoteAction(),null!=i.children&&(e=!0,t.buildChildrenList(i,"remote_"))):i.isImport?(t.chapterList.push("import_"+i.id),t.isImportAction(),null!=i.children&&(e=!0,t.buildChildrenList(i,"import_"))):t.chapterList.push(i.id)}),e||this.storeChanges()},fillChapterList:function(){var t=this;this.chapters.forEach(function(e){t.chapterList.push(e.id)})},buildChildrenList:function(t,e){var i=this,s=[],n=!1;t.children.forEach(function(t){s.push(e+t.id),null!=t.children&&(n=!0,i.buildChildrenList(t,e))}),"section"==t.type.toLowerCase()?this.blockList[e+t.id]=s:this[t.children[0].type.toLowerCase()+"List"][e+t.id]=s,n||this.storeChanges()},isRemoteAction:function(){this.remoteData=!0,this.importData=!0},isImportAction:function(){this.remoteData=!1,this.importData=!0},updateList:function(t){var e=t.list,i=Object.keys(e)[0];this[t.type+"List"][i]=e[i],t.hasChildren||(this.fillChapterList(),this.storeChanges())},addChild:function(t){this.chapters.push(t)},removeChapter:function(t){var e=[];this.chapters.forEach(function(i){i.id!=t.id&&e.push(i)}),this.chapters=e},importFromCourse:function(){this.actionTitle=this.courseImportText,this.showRemoteCourseware=!0},resetActionMenu:function(){this.actionTitle="Aktionen",this.fileError=!1,this.remoteCourseware=null,this.importCourseware=null,this.showRemoteCourseware=!1,this.showImportCourseware=!1},storeChanges:function(){if(this.storeLock)console.log("storeLock");else{this.storeLock=!0;var t=this,e=[],i={};if(t.importData&&!t.remoteData){var s=this.importZIP,n=new Promise(function(t){var e=new FileReader;e.readAsDataURL(s),e.onloadend=function(){i.file=e.result,i.name=s.name,i.size=s.size,i.type=s.type,t(e.result)}});e.push(n)}Promise.all(e).then(function(){B.a.post("store_changes_vue",{cid:COURSEWARE.config.cid,import:t.importData,remote:t.remoteData,importXML:t.importXML,chapterList:JSON.stringify(t.chapterList),subchapterList:JSON.stringify(t.subchapterList),sectionList:JSON.stringify(t.sectionList),blockList:JSON.stringify(t.blockList),fileData:i}).then(function(e){t.importData=!1,t.remoteData=!1,t.cleanLists(),t.courseware=JSON.parse(e.data.courseware),t.storeLock=!1}).catch(function(t){t.response?(console.log(t.response.data),console.log(t.response.status),console.log(t.response.headers)):t.request?console.log(t.request):console.log("Error",t.message),console.log(t.config)})})}},cleanLists:function(){this.chapterList=[],this.subchapterList={},this.sectionList={},this.blockList={}},getRemoteCourse:function(t){this.loading=!0;var e=this;B.a.get("get_remote_course",{params:{cid:COURSEWARE.config.cid,remote_cid:t.remoteId}}).then(function(t){e.remoteCourseware=t.data}).then(function(){e.actionTitle="Import: "+t.remoteName,e.showRemoteCourseware=!0,e.loading=!1}).catch(function(t){console.log("there was an error: "+t.response)})},setImport:function(){this.loading=!0;var t=this;t.fileError=!1,this.importZIP=event.target.files[0],this.showImportCourseware=!0,ZipLoader.unzip(this.importZIP).then(function(e){var i,s,n;if(void 0!=e.files["data.xml"]){i=e.extractAsText("data.xml"),s=new DOMParser,n=s.parseFromString(i,"text/xml");var o=0,a=0,r=0;t.importCourseware=[],t.importCourseware["chapters"]=[],$.each(n.documentElement.children,function(e,i){if("chapter"==i.nodeName){o++,i.setAttribute("temp-id",o);var s=t.importCourseware["chapters"].push({title:i.getAttribute("title"),id:o,publication_date:!1,withdraw_date:!1,isPublished:!0,isImport:!0,type:i.nodeName}),n=t.importCourseware["chapters"][s-1];if("undefined"===typeof n)return!0;n.children=[],$.each(i.children,function(e,i){if("subchapter"==i.nodeName){a++,i.setAttribute("temp-id",a);var s=n.children.push({title:i.getAttribute("title"),id:a,publication_date:!1,withdraw_date:!1,isPublished:!0,isImport:!0,type:i.nodeName}),o=n.children[s-1];if("undefined"===typeof o)return!0;o.children=[],$.each(i.children,function(e,i){if("section"==i.nodeName){r++,i.setAttribute("temp-id",r);var s=o.children.push({title:i.getAttribute("title"),id:r,isPublished:!0,isImport:!0,type:i.nodeName}),n=o.children[s-1];if("undefined"===typeof n)return!0;n.children=[],$.each(i.children,function(e,i){"block"==i.nodeName&&n.children.push({type:i.getAttribute("type"),id:i.getAttribute("uuid"),isPublished:!0,isImport:!0,preview:t.getContent(i),readable_name:t.blockMap[i.getAttribute("type")]})}),0==n.children.length&&(n.children=null)}}),0==o.children.length&&(o.children=null)}}),0==n.children.length&&(n.children=null)}});var l=new XMLSerializer;t.importXML=l.serializeToString(n)}else t.fileError=!0}).then(function(){t.loading=!1,t.fileError||(t.showImportCourseware=!0),t.actionTitle="Import: "+t.importZIP.name+" ("+t.calcFileSize(t.importZIP.size)+")"})},calcFileSize:function(t){return 0!=(t/1048576).toFixed(0)?(t/1048576).toFixed(1)+" MB":(t/1024).toFixed(1)+" kB"}}},wt=vt,kt=Object(w["a"])(wt,n,o,!1,null,null,null),Dt=kt.exports;s["a"].config.productionTip=!1,new s["a"]({render:function(t){return t(Dt)}}).$mount("#block_mananger_content")}});
//# sourceMappingURL=index.js.map